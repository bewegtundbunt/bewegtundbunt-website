<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>bewegt & bunt ‚Äì Generator</title>
<style>
:root {
  --green-darkest: #287736;
  --green-dark:    #2CB52C;
  --green-light:   #92FEBB;
  --green-pale:    #B0E04B;
  --green-bg:      #e8f5e2;
  --cream:         #f5fbf2;
  --dark:          #1a2e1e;
  --grey:          #5a6e5d;
  --border:        #d4e8d4;
  --card-bg:       #ffffff;
  --radius:        16px;
}
* { box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: var(--cream);
  min-height: 100vh;
  color: var(--dark);
}

/* ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ */
.topbar {
  background: var(--dark);
  color: #fff;
  padding: 0.9rem 2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.topbar-logo { font-size: 1.1rem; font-weight: 800; color: var(--green-light); }
.topbar-right { display: flex; gap: 1rem; align-items: center; }
.topbar a {
  color: #9ec49e;
  text-decoration: none;
  font-size: 0.85rem;
  font-weight: 600;
  transition: color 0.2s;
}
.topbar a:hover { color: var(--green-light); }
.btn-back {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  color: #fff !important;
  padding: 0.4rem 1rem;
  border-radius: 100px;
  font-size: 0.82rem !important;
}
.btn-back:hover { background: rgba(255,255,255,0.2) !important; }

/* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
.main {
  max-width: 860px;
  margin: 0 auto;
  padding: 2.5rem 1.5rem 4rem;
}
h1 { font-size: 1.8rem; font-weight: 800; margin-bottom: 0.3rem; color: var(--dark); }
.subtitle { color: var(--grey); margin-bottom: 2rem; font-size: 0.95rem; }

/* ‚îÄ‚îÄ FORM CARD ‚îÄ‚îÄ */
.card {
  background: var(--card-bg);
  padding: 2rem;
  border-radius: var(--radius);
  box-shadow: 0 4px 24px rgba(0,0,0,0.07);
  margin-bottom: 2rem;
}
.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.2rem;
  margin-bottom: 1.2rem;
}
.form-group { display: flex; flex-direction: column; }
label {
  font-weight: 700;
  font-size: 0.78rem;
  color: var(--grey);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.4rem;
}
input, select {
  padding: 0.7rem 0.9rem;
  border-radius: 10px;
  border: 1.5px solid var(--border);
  font-size: 0.95rem;
  transition: border-color 0.2s;
  color: var(--dark);
  background: #fff;
}
input:focus, select:focus {
  outline: none;
  border-color: var(--green-darkest);
}
.btn-generate {
  width: 100%;
  margin-top: 0.5rem;
  padding: 0.9rem 1.5rem;
  background: linear-gradient(135deg, var(--green-darkest), #2CB52C);
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: opacity 0.2s, transform 0.2s;
  box-shadow: 0 4px 16px #28773640;
}
.btn-generate:hover:not(:disabled) { opacity: 0.92; transform: translateY(-2px); }
.btn-generate:disabled { opacity: 0.6; cursor: not-allowed; }
.spinner {
  width: 16px; height: 16px;
  border: 2px solid rgba(255,255,255,0.4);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.7s linear infinite;
  display: none;
}
.btn-generate.loading .spinner { display: block; }
@keyframes spin { to { transform: rotate(360deg); } }

/* ‚îÄ‚îÄ STATUS ‚îÄ‚îÄ */
#status {
  margin-top: 1rem;
  padding: 0.8rem 1rem;
  border-radius: 10px;
  font-size: 0.9rem;
  display: none;
}
#status.error { display: block; background: #fef2f2; border: 1px solid #fca5a5; color: #b91c1c; }
#status.success { display: block; background: #f0fdf4; border: 1px solid #86efac; color: #166534; }

/* ‚îÄ‚îÄ RESULT ‚îÄ‚îÄ */
#result { display: none; }

.result-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1rem;
  flex-wrap: wrap;
  gap: 0.5rem;
}
.result-header h2 { font-size: 1.3rem; font-weight: 800; }
.btn-print {
  background: var(--green-darkest);
  color: #fff;
  border: none;
  padding: 0.55rem 1.2rem;
  border-radius: 100px;
  font-size: 0.85rem;
  font-weight: 700;
  cursor: pointer;
  transition: opacity 0.2s;
}
.btn-print:hover { opacity: 0.85; }

.result-section {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 1.3rem 1.5rem;
  margin-bottom: 1.2rem;
}
.result-section h3 {
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--green-darkest);
  margin: 0 0 1rem 0;
  font-weight: 700;
}

/* meta grid */
.meta-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
  gap: 0.8rem;
}
.meta-item {
  background: var(--cream);
  border-radius: 10px;
  padding: 0.8rem 1rem;
  border: 1px solid var(--border);
}
.meta-item .val { font-size: 1.3rem; font-weight: 800; color: var(--green-darkest); }
.meta-item .key { font-size: 0.72rem; color: var(--grey); margin-top: 0.2rem; }

/* timeline */
.timeline-item {
  display: flex;
  gap: 1rem;
  padding: 0.9rem 0;
  border-bottom: 1px solid #eef6ee;
}
.timeline-item:last-child { border-bottom: none; }
.t-time {
  font-size: 0.78rem;
  color: var(--grey);
  min-width: 90px;
  padding-top: 2px;
  line-height: 1.4;
}
.t-body { flex: 1; }
.t-title { font-weight: 700; font-size: 0.95rem; }
.t-type {
  display: inline-block;
  font-size: 0.7rem;
  padding: 2px 8px;
  border-radius: 20px;
  background: var(--green-bg);
  color: var(--green-darkest);
  margin-top: 3px;
  font-weight: 600;
}
.t-content { font-size: 0.85rem; color: #555; margin-top: 0.4rem; line-height: 1.6; }
.t-material {
  font-size: 0.78rem;
  color: var(--green-darkest);
  margin-top: 0.35rem;
  background: var(--green-bg);
  border-radius: 6px;
  padding: 0.3rem 0.6rem;
  display: inline-block;
}

/* materials */
.mat-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 0.5rem;
}
.mat-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.7rem;
  background: var(--cream);
  border-radius: 8px;
  border: 1px solid var(--border);
  font-size: 0.85rem;
}
.mat-item::before { content: "üì¶"; font-size: 0.9rem; }
.mat-qty { font-weight: 700; color: var(--green-darkest); margin-left: auto; font-size: 0.8rem; }

/* tips */
.tip-item {
  padding: 0.5rem 0;
  border-bottom: 1px solid #eef6ee;
  font-size: 0.9rem;
  display: flex;
  gap: 0.5rem;
  align-items: flex-start;
}
.tip-item:last-child { border-bottom: none; }
.tip-item::before { content: "üí°"; flex-shrink: 0; }

/* closing quote */
.closing-quote {
  background: linear-gradient(135deg, var(--green-darkest), #1a5c20);
  color: #fff;
  border-radius: 14px;
  padding: 1.5rem 2rem;
  text-align: center;
  margin-bottom: 1.2rem;
}
.closing-quote blockquote {
  font-family: Georgia, serif;
  font-style: italic;
  font-size: 1.1rem;
  line-height: 1.7;
  margin: 0;
  color: #c8f0c8;
}
.closing-quote .quote-author {
  margin-top: 0.8rem;
  font-size: 0.8rem;
  color: #92FEBB;
  font-weight: 600;
}

/* counter badge */
.counter-badge {
  display: inline-block;
  background: var(--green-pale);
  color: var(--dark);
  font-size: 0.72rem;
  font-weight: 700;
  padding: 0.2rem 0.6rem;
  border-radius: 100px;
  margin-left: 0.5rem;
  vertical-align: middle;
}

@media (max-width: 600px) {
  .form-row { grid-template-columns: 1fr; }
  .topbar { padding: 0.8rem 1rem; }
}

/* Print */
@media print {
  .topbar, .card, .btn-print, #status { display: none !important; }
  body { background: #fff; }
  .result-section { box-shadow: none; border: 1px solid #ccc; }
}
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="topbar-logo">bewegt &amp; bunt</div>
  <div class="topbar-right">
    <a href="/" class="btn-back">‚Üê Zur Website</a>
    <a href="#" onclick="logout()">Abmelden</a>
  </div>
</div>

<div class="main">
  <h1>üèÉ Bewegungsstunde erstellen</h1>
  <p class="subtitle">bewegt &amp; bunt ‚Äì Strukturierter Stundenplan-Generator</p>
  <div id="seasonBadge" style="display:inline-flex;align-items:center;gap:0.5rem;background:#fff;border:1.5px solid var(--border);border-radius:100px;padding:0.4rem 1rem;font-size:0.82rem;font-weight:600;color:var(--green-darkest);margin-bottom:1.5rem;"></div>

  <div class="card">
    <div class="form-row">
      <div class="form-group">
        <label>Bereich</label>
        <select id="bereich">
          <option value="krippe">Krippe (0‚Äì3 Jahre)</option>
          <option value="kindergarten" selected>Kindergarten (3‚Äì6 Jahre)</option>
        </select>
      </div>
      <div class="form-group">
        <label>Zieldauer</label>
        <select id="targetMinutes">
          <option value="15">15 Minuten</option>
          <option value="30" selected>30 Minuten</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Anzahl Kinder</label>
        <select id="kinderAnzahl">
          <option value="5">5 Kinder</option>
          <option value="8">8 Kinder</option>
          <option value="10">10 Kinder</option>
          <option value="12" selected>12 Kinder</option>
          <option value="15">15 Kinder</option>
          <option value="20">20 Kinder</option>
          <option value="25">25 Kinder</option>
        </select>
      </div>

    </div>

    <button class="btn-generate" id="generateBtn" onclick="generate()">
      <div class="spinner"></div>
      <span id="btnText">Stunde generieren</span>
    </button>
    <div id="status"></div>
  </div>

  <!-- RESULT -->
  <div id="result">
    <div class="result-header">
      <h2>Deine Bewegungsstunde</h2>
      <button class="btn-print" onclick="window.print()">üñ®Ô∏è Drucken</button>
    </div>
    <div id="result-content"></div>
  </div>
</div>

  <!-- VERLAUF -->
  <div id="historySection" style="margin-top:2rem;display:none;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;">
      <h2 style="font-size:1.2rem;font-weight:800;">üïê Zuletzt generiert</h2>
      <button onclick="loadHistory()" style="background:transparent;border:1.5px solid var(--border);color:var(--green-darkest);padding:0.4rem 1rem;border-radius:100px;font-size:0.82rem;font-weight:600;cursor:pointer;">Aktualisieren</button>
    </div>
    <div id="historyList"></div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
<script>
const SUPABASE_URL      = "https://jhgoqrinhdtowuhzirnf.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_uu0Xh8f_71Dk1qAQ_UirpQ_u-P4eSBG";
let supabaseClient;
try {
  supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
} catch(e) { console.error("Supabase init error:", e); }

// ‚îÄ‚îÄ AUTH CHECK ‚îÄ‚îÄ
async function checkAuth() {
  if (!supabaseClient) return;
  const { data } = await supabaseClient.auth.getSession();
  if (!data.session) window.location.href = "login.html";
}
checkAuth();

async function logout() {
  if (supabaseClient) await supabaseClient.auth.signOut();
  window.location.href = "login.html";
}

// ‚îÄ‚îÄ ABSCHLUSSSPR√úCHE (rotierend, nie "bewegt und bunt") ‚îÄ‚îÄ
const CLOSING_QUOTES = [
  { text: "Bewegung ist die Sprache, die alle Kinder sprechen ‚Äì lange bevor sie Worte kennen.", author: "Friedrich Fr√∂bel" },
  { text: "Kinder brauchen keine perfekte Stunde ‚Äì sie brauchen jemanden, der mit ihnen in Bewegung bleibt.", author: "Unbekannt" },
  { text: "Der K√∂rper ist das erste Zuhause, das ein Kind kennt. Lass es darin wohnen.", author: "P√§dagogische Weisheit" },
  { text: "Durch Spielen lernt das Kind, dass es die Welt gestalten kann.", author: "Maria Montessori" },
  { text: "Kinder lernen am besten, wenn sie sich bewegen ‚Äì denn Bewegung ist Denken in Aktion.", author: "Carla Hannaford" },
  { text: "Jede Bewegungsstunde ist eine Einladung: Trau dich, sei dabei, wachse.", author: "P√§dagogische Weisheit" },
  { text: "Was im K√∂rper beginnt, findet seinen Weg in den Geist.", author: "Unbekannt" },
  { text: "Kinder, die sich bewegen d√ºrfen, denken klarer ‚Äì und l√§cheln h√§ufiger.", author: "Sportp√§dagogik" },
  { text: "Eine gute Bewegungsstunde endet nicht wenn die Zeit um ist, sondern wenn die Energie noch nachhallt.", author: "Unbekannt" },
  { text: "Spielen ist die ernsteste Besch√§ftigung der Kindheit.", author: "Charles Baudelaire" },
  { text: "Gesundheit ist nicht alles, aber ohne Gesundheit ist alles nichts.", author: "Arthur Schopenhauer" },
  { text: "Das Geheimnis guter P√§dagogik liegt darin, die Begeisterung zu sch√ºtzen.", author: "Unbekannt" }
];

// ‚îÄ‚îÄ VORLAGEN ‚Äì strikte Reihenfolge, KEIN Zufall ‚îÄ‚îÄ
const TEMPLATES = {
  krippe: {
    15: [
      {
        title: "Hampelm√§nner & Begr√º√üungsrunde",
        thema: "K√∂rperwahrnehmung",
        timeline: [
          { title: "Ankommen & Begr√º√üung", type: "Einf√ºhrung", dauer: 3, content: "Kinder setzen sich im Kreis. Jedes Kind wird mit Namen begr√º√üt. Gemeinsames Einatmen und Strecken.", material: "Sitzkissen" },
          { title: "Warm-up: Hampelm√§nner", type: "Warm-up", dauer: 4, content: "Alle machen gemeinsam Hampelm√§nner im Stehen. Langsam beginnen, Tempo steigern.", material: "Keine" },
          { title: "Hauptteil: K√∂rperteile zeigen", type: "Hauptteil", dauer: 5, content: "Lehrperson nennt K√∂rperteil ‚Äì Kinder tippen darauf. Steigern: zwei K√∂rperteile gleichzeitig.", material: "Keine" },
          { title: "Abschluss & Entspannung", type: "Abschluss", dauer: 3, content: "Kinder legen sich auf den Boden. Ruhige Musik. Arme und Beine strecken und wieder einziehen.", material: "Matten, Musik-Player" }
        ],
        materials: ["Sitzkissen", "Matten", "Musik-Player"],
        tips: ["Langsames Tempo f√ºr Krippe beibehalten", "Wiederholungen helfen beim Lernen", "Lob f√ºr jeden Versuch"]
      },
      {
        title: "Rollkugeln & Tuchspiel",
        thema: "Gleichgewicht & Tastsinn",
        timeline: [
          { title: "Ankommen & Einf√ºhrung", type: "Einf√ºhrung", dauer: 2, content: "Kinder sitzen im Kreis. Kurze Vorstellung des Spiels mit T√ºchern.", material: "Bunte T√ºcher" },
          { title: "Warm-up: Tuch schwingen", type: "Warm-up", dauer: 3, content: "Jedes Kind bekommt ein Tuch. Gemeinsam schwingen, werfen, fangen.", material: "Bunte T√ºcher (1 pro Kind)" },
          { title: "Hauptteil: Kugeln rollen", type: "Hauptteil", dauer: 7, content: "Weiche B√§lle werden hin und hergerollt. Erst auf dem Boden, dann √ºber kleine Rampen aus Matten.", material: "Weiche B√§lle, Matten" },
          { title: "Abschluss: Tuch-Entspannung", type: "Abschluss", dauer: 3, content: "Tuch sanft √ºber den K√∂rper des Kindes legen (mit Erlaubnis). Ruhige Atmung.", material: "Bunte T√ºcher, Matten" }
        ],
        materials: ["Bunte T√ºcher (1 pro Kind)", "Weiche B√§lle (5‚Äì8)", "Matten (4‚Äì6)"],
        tips: ["Auf √úberreizung achten", "Tuchkontakt nur wenn Kind einwilligt", "Langsame ruhige Sprache"]
      },
      {
        title: "Spaziergang durch den Wald",
        thema: "Fantasie & Grobmotorik",
        timeline: [
          { title: "Ankommen & Geschichte", type: "Einf√ºhrung", dauer: 3, content: "Kurze Geschichte vorlesen: Wir gehen heute in den Wald! Was sehen wir?", material: "Bilderbuch (optional)" },
          { title: "Warm-up: Tiere imitieren", type: "Warm-up", dauer: 3, content: "B√§r brummt und stampft, Vogel flattert, Hase h√ºpft ‚Äì alle machen mit.", material: "Keine" },
          { title: "Hauptteil: Waldparcours", type: "Hauptteil", dauer: 6, content: "√úber Steine balancieren (Kissen), unter √Ñsten ducken (Stab auf St√ºhlen), durch Pf√ºtzen h√ºpfen (Kreise).", material: "Kissen, St√§be, St√ºhle, Kreide/Klebeband" },
          { title: "Abschluss: Am Lagerfeuer", type: "Abschluss", dauer: 3, content: "Alle sitzen im Kreis um ein imagin√§res Feuer. H√§nde w√§rmen, ruhig atmen.", material: "Keine" }
        ],
        materials: ["Kissen (6‚Äì8)", "St√§be (2)", "St√ºhle (2)", "Klebeband oder Kreide"],
        tips: ["Geschichte motiviert Krippe-Kinder sehr", "Parcours altersgerecht niedrig halten", "Sicherheit beim Balancieren beachten"]
      },
      {
        title: "Bubble & Ballonspiel",
        thema: "Auge-Hand-Koordination",
        timeline: [
          { title: "Ankommen & Zauberwelt", type: "Einf√ºhrung", dauer: 2, content: "Seifenblasen im Raum pusten ‚Äì Kinder beobachten und wundern sich.", material: "Seifenblasen" },
          { title: "Warm-up: Blasen fangen", type: "Warm-up", dauer: 4, content: "Kinder laufen den Seifenblasen nach und versuchen sie zu fangen.", material: "Seifenblasen" },
          { title: "Hauptteil: Luftballon oben halten", type: "Hauptteil", dauer: 6, content: "Luftballon darf nicht den Boden ber√ºhren ‚Äì erst allein, dann zu zweit.", material: "Luftballons (2 pro Paar)" },
          { title: "Abschluss: Ballon im Kreis", type: "Abschluss", dauer: 3, content: "Alle sitzen im Kreis, Ballon wird sanft weitergegeben. Ruhige Bewegungen.", material: "Luftballons" }
        ],
        materials: ["Seifenblasen (2 Flaschen)", "Luftballons (aufgeblasen, 6‚Äì8)"],
        tips: ["Auf Latexallergie achten!", "Ballons nicht zu stark aufpusten", "Langsame Variante f√ºr ruhigere Kinder"]
      },
      {
        title: "Spiegel & Schatten",
        thema: "Imitation & K√∂rperbewusstsein",
        timeline: [
          { title: "Ankommen & Spiegelspiel", type: "Einf√ºhrung", dauer: 3, content: "Lehrperson macht Bewegungen vor ‚Äì Kinder imitieren wie ein Spiegel.", material: "Keine" },
          { title: "Warm-up: Gro√üer & kleiner K√∂rper", type: "Warm-up", dauer: 3, content: "Abwechselnd ganz gro√ü machen (strecken) und ganz klein (zusammenkauern).", material: "Keine" },
          { title: "Hauptteil: Partnerspiegel", type: "Hauptteil", dauer: 6, content: "Kinder in Paaren: einer macht, der andere spiegelt. Dann tauschen.", material: "Keine" },
          { title: "Abschluss: Schattenruhe", type: "Abschluss", dauer: 3, content: "Kinder legen sich auf den Boden. Kurze Entspannung mit ruhiger Musik.", material: "Musik-Player, Matten" }
        ],
        materials: ["Matten (1 pro Kind)", "Musik-Player"],
        tips: ["Paare gut zusammenstellen", "Tempo langsam beginnen", "Lob f√ºr Kreativit√§t"]
      },
      {
        title: "F√ºhlpfad & Barfu√ülaufen",
        thema: "Sensorische Integration",
        timeline: [
          { title: "Ankommen & Vorbereitung", type: "Einf√ºhrung", dauer: 2, content: "Schuhe und Socken ausziehen. Kurz erkl√§ren: Heute erkunden unsere F√º√üe die Welt!", material: "Keine" },
          { title: "Warm-up: Zehen wippen", type: "Warm-up", dauer: 3, content: "Auf Zehenspitzen stehen, Fersen heben und senken. Im Stehen wippen.", material: "Keine" },
          { title: "Hauptteil: F√ºhlpfad", type: "Hauptteil", dauer: 7, content: "Verschiedene Unterlagen auslegen: Matte, Sand in Wanne, Kieselsteine (weich), Tuch. Kinder gehen langsam durch.", material: "Matte, Sandwanne, Kieselstein-Matte, T√ºcher" },
          { title: "Abschluss: Fu√ümassage", type: "Abschluss", dauer: 3, content: "Kinder massieren sich gegenseitig (oder selbst) die F√º√üe mit einem Igelball.", material: "Igelb√§lle (1 pro Kind)" }
        ],
        materials: ["Sandwanne", "Kieselstein-Matte", "Weiche T√ºcher", "Igelb√§lle (1 pro Kind)"],
        tips: ["Sauberkeit sicherstellen", "Kinder die nicht wollen, k√∂nnen zuschauen", "Sehr beruhigende Wirkung"]
      }
    ],
    30: [
      {
        title: "Gro√üer Bewegungsparcours",
        thema: "Grobmotorik & Koordination",
        timeline: [
          { title: "Ankommen & Begr√º√üungsritual", type: "Einf√ºhrung", dauer: 5, content: "Kreis bilden. Jedes Kind wird mit H√§ndesch√ºtteln und Namen begr√º√üt. Kurze Atem√ºbung: tief einatmen, laut ausatmen.", material: "Sitzkissen" },
          { title: "Warm-up: Tierwanderung", type: "Warm-up", dauer: 7, content: "Kinder bewegen sich als verschiedene Tiere durch den Raum: Elefant (schwer), Maus (leise), Vogel (Arme ausbreiten). Wechsel auf Zuruf.", material: "Keine" },
          { title: "Hauptteil: Parcours", type: "Hauptteil", dauer: 13, content: "Station 1: Kriechtunnel (2 min). Station 2: Balancierbalken (3 min). Station 3: Sprungpunkte (3 min). Station 4: Rollmatte (3 min). Kinder rotieren nach Signal.", material: "Kriechtunnel, Balancierbalken, Klebeband-Markierungen, Rollmatte" },
          { title: "Abschluss: Entspannungskreis", type: "Abschluss", dauer: 5, content: "Alle legen sich auf Matten im Kreis (K√∂pfe zur Mitte). Ruhige Musik. Kurze Geschichte √ºber einen Sonnentag vorlesen.", material: "Matten, Musik-Player" }
        ],
        materials: ["Sitzkissen", "Kriechtunnel", "Balancierbalken", "Klebeband", "Rollmatte", "Matten", "Musik-Player"],
        tips: ["Stationen vorher aufbauen", "Klare Signale f√ºr Wechsel", "Krippe braucht viel Einzelaufmerksamkeit"]
      },
      {
        title: "Tanz & Rhythmus f√ºr die Krippe",
        thema: "Rhythmusgef√ºhl & Soziales",
        timeline: [
          { title: "Ankommen & Trommeln", type: "Einf√ºhrung", dauer: 4, content: "Kinder sitzen im Kreis. Jedes Kind bekommt eine kleine Trommel oder tippt auf Knie. Gemeinsam klopfen.", material: "Kleine Trommeln oder Rasseln" },
          { title: "Warm-up: Klatschspiel", type: "Warm-up", dauer: 5, content: "Einfache Klatschmuster: 1x, 2x, 3x. Dann mit Stampfen kombinieren.", material: "Keine" },
          { title: "Hauptteil: Tanz mit T√ºchern", type: "Hauptteil", dauer: 14, content: "Jedes Kind bekommt ein Tuch. Verschiedene Musikst√ºcke: langsam schwingen, schnell wedeln, auf Boden legen und aufheben. 3 Lieder √† ca. 4 Minuten.", material: "Bunte T√ºcher (1 pro Kind), Musik-Player" },
          { title: "Abschluss: Leises Summen", type: "Abschluss", dauer: 7, content: "Alle sitzen, T√ºcher √ºber die Knie. Leises Summst√ºck. Kinder summen mit. Langsam ausklingen.", material: "T√ºcher, Musik-Player" }
        ],
        materials: ["Kleine Trommeln oder Rasseln", "Bunte T√ºcher (1 pro Kind)", "Musik-Player"],
        tips: ["Ruhige Musikauswahl f√ºr Krippe", "Wechsel von laut/leise bewusst einbauen", "T√ºcher beruhigen"]
      },
      {
        title: "Wasser & Sinne",
        thema: "Sensorische Erfahrung",
        timeline: [
          { title: "Ankommen & Neugier wecken", type: "Einf√ºhrung", dauer: 4, content: "Sch√ºsseln mit Wasser stehen im Raum. Kinder erkunden mit Fingern vorsichtig. Erz√§hlen: Was f√ºhlt ihr?", material: "Sch√ºsseln mit Wasser, Handt√ºcher" },
          { title: "Warm-up: Regen imitieren", type: "Warm-up", dauer: 5, content: "Finger-Regen: alle tippen schnell auf Oberschenkel. Dann langsamer Regen (einzelne Tropfen).", material: "Keine" },
          { title: "Hauptteil: Bewegungs-Wasserspiele", type: "Hauptteil", dauer: 15, content: "Station 1: Schw√§mme ausdr√ºcken (6 min). Station 2: Wasser in Becher f√ºllen ohne H√§nde (L√∂ffel) (5 min). Station 3: nasse F√º√üe trockentupfen (4 min).", material: "Schw√§mme, Sch√ºsseln, Becher, L√∂ffel, Handt√ºcher" },
          { title: "Abschluss: Trocken & ruhig", type: "Abschluss", dauer: 6, content: "H√§nde trocknen. Im Kreis sitzen. Kurze Nachbesprechung: Was hat sich am besten angef√ºhlt?", material: "Handt√ºcher" }
        ],
        materials: ["Sch√ºsseln mit Wasser (4)", "Schw√§mme (8)", "Becher", "L√∂ffel", "Handt√ºcher"],
        tips: ["Kleidungsschutz vorbereiten", "Wassertemperatur pr√ºfen", "Aufsicht erh√∂hen bei Wasser"]
      },
      {
        title: "Bausteine & K√∂rper",
        thema: "Raumwahrnehmung & Kreativit√§t",
        timeline: [
          { title: "Ankommen & Vorzeigen", type: "Einf√ºhrung", dauer: 4, content: "Gro√üe Weichschaum-Bausteine im Raum. Lehrperson baut einen Turm ‚Äì Kinder schauen zu und wollen mitmachen.", material: "Weichschaum-Bausteine" },
          { title: "Warm-up: Baumeister-Yoga", type: "Warm-up", dauer: 6, content: "Einfache Yoga-Posen: Baum (ein Bein heben), Br√ºcke (auf Boden), Mauer (gerade stehen, Arme seitlich).", material: "Matten" },
          { title: "Hauptteil: Freies Bauen & Klettern", type: "Hauptteil", dauer: 14, content: "Kinder bauen frei mit Bausteinen. Lehrperson baut sichere Hindernisse zum Dr√ºbersteigen, Draufsetzen, Drunterkrabbeln.", material: "Weichschaum-Bausteine (10+), Matten" },
          { title: "Abschluss: Bausteine aufr√§umen als Spiel", type: "Abschluss", dauer: 6, content: "Wer kann mit einem Baustein auf dem Kopf balancieren? Bausteine werden so zum Regal gebracht.", material: "Weichschaum-Bausteine" }
        ],
        materials: ["Weichschaum-Bausteine (10‚Äì15)", "Matten (4‚Äì6)"],
        tips: ["Bausteine sind ideal f√ºr Krippe", "Freies Spiel ist p√§dagogisch wertvoll", "Aufr√§umen als √úbung integrieren"]
      },
      {
        title: "Zug & Zirkus",
        thema: "Soziales Spiel & Gleichgewicht",
        timeline: [
          { title: "Ankommen: Der Zug f√§hrt ein", type: "Einf√ºhrung", dauer: 4, content: "Alle stehen in einer Reihe und halten sich an den Schultern. Der Zug f√§hrt durch den Raum.", material: "Keine" },
          { title: "Warm-up: Zirkusartisten", type: "Warm-up", dauer: 6, content: "Jongleur (T√ºcher werfen), Seilt√§nzer (auf Linie balancieren), Akrobat (Rolle vorw√§rts auf Matte).", material: "T√ºcher, Klebebandlinie, Matte" },
          { title: "Hauptteil: Zirkusnummern", type: "Hauptteil", dauer: 14, content: "Kinder f√ºhren kleine Nummern vor: Balancieren mit Kissen auf dem Kopf, Hula-Hoop ausprobieren, T√ºcher jonglieren. Jedes Kind ist K√ºnstler.", material: "Kissen, Hula-Hoop (2), T√ºcher" },
          { title: "Abschluss: Verbeugung & Ruhe", type: "Abschluss", dauer: 6, content: "Alle verbeugen sich (Applaus!). Dann ruhig auf Matten legen. Lehrperson liest kurze Geschichte.", material: "Matten" }
        ],
        materials: ["Bunte T√ºcher", "Klebeband", "Matten", "Kissen (1 pro Kind)", "Hula-Hoop (2)"],
        tips: ["Verbeugung st√§rkt Selbstwert", "Auf Sicherheit bei Rollen achten", "Jedes Kind in Rampenlicht lassen"]
      },
      {
        title: "Herbstwald-Entdeckung",
        thema: "Naturmotorik & Fantasie",
        timeline: [
          { title: "Ankommen: Bl√§tter sammeln", type: "Einf√ºhrung", dauer: 5, content: "Bunte Papierbl√§tter liegen im Raum. Kinder sammeln so viele wie m√∂glich und bringen sie in den Kreis.", material: "Papierbl√§tter (bunt, ausgeschnitten)" },
          { title: "Warm-up: Eichh√∂rnchen sammeln", type: "Warm-up", dauer: 6, content: "Jedes Kind ist ein Eichh√∂rnchen und sammelt N√ºsse (B√§lle) und bringt sie in sein Nest (Kiste).", material: "Kleine B√§lle, Kisten (1 pro Kind)" },
          { title: "Hauptteil: Waldleben", type: "Hauptteil", dauer: 13, content: "Stationen: Ast balancieren (Balken), Igel suchen (unter T√ºchern), B√§ren-H√∂hle (Tunnel), Laubberg (Kissen-Berg).", material: "Balancierbalken, T√ºcher, Tunnel, Kissen" },
          { title: "Abschluss: Herbstlied & Schlafen", type: "Abschluss", dauer: 6, content: "Herbstlied singen. Dann alle wie Tiere im Winter 'schlafen' (auf Matten legen). Leise Musik.", material: "Matten, Musik-Player" }
        ],
        materials: ["Papierbl√§tter (bunt, 30+)", "Kleine B√§lle (10)", "Kisten (3)", "Balancierbalken", "T√ºcher", "Kriechtunnel", "Kissen", "Matten", "Musik-Player"],
        tips: ["Herbstthema kann auch drau√üen stattfinden", "Viel Fantasie aktivieren", "Ruhiger Abschluss wichtig f√ºr Krippe"]
      }
    ]
  },
  kindergarten: {
    15: [
      {
        title: "Schneller Kreis & Reaktionsspiel",
        thema: "Reaktionsf√§higkeit & Teamwork",
        timeline: [
          { title: "Ankommen & Einf√ºhrung", type: "Einf√ºhrung", dauer: 3, content: "Alle im Kreis stehen. Kurze Vorstellung des Spiels. Wer kennt das Stille-Post-Spiel mit H√§nden?", material: "Keine" },
          { title: "Warm-up: Handdruck-Kreis", type: "Warm-up", dauer: 3, content: "Impulse werden durch H√§ndedruck im Kreis weitergegeben. Wer dr√ºckt zu fr√ºh, scheidet aus.", material: "Keine" },
          { title: "Hauptteil: Reaktionsspiele", type: "Hauptteil", dauer: 6, content: "1) Farben-Lauf: Farbkarten hochhalten ‚Äì Kinder rennen zur richtigen Matte (3 min). 2) Freeze-Dance: Musik stoppt ‚Äì alle erstarren (3 min).", material: "Farbkarten, Farbige Matten, Musik-Player" },
          { title: "Abschluss & Auswertung", type: "Abschluss", dauer: 3, content: "Im Kreis: Jeder sagt eine Sache, die ihm Spa√ü gemacht hat. Gemeinsames Abklatschen.", material: "Keine" }
        ],
        materials: ["Farbkarten (4 Farben)", "Farbige Matten (4)", "Musik-Player"],
        tips: ["Freeze-Dance sehr motivierend", "Auf Fairness achten", "Lob f√ºr Schnelligkeit UND f√ºr Bremsen"]
      },
      {
        title: "Balancier-Olympiade",
        thema: "Gleichgewicht & Konzentration",
        timeline: [
          { title: "Einf√ºhrung: Was ist Balance?", type: "Einf√ºhrung", dauer: 2, content: "Kurze Demo: Lehrperson balanciert Kissen auf dem Kopf. Kinder probieren sofort aus.", material: "Kissen (1 pro Kind)" },
          { title: "Warm-up: Einbeinstand", type: "Warm-up", dauer: 3, content: "Auf einem Bein stehen, Augen zu, 10 Sekunden. Dann andere Seite.", material: "Keine" },
          { title: "Hauptteil: Balancier-Stationen", type: "Hauptteil", dauer: 7, content: "Station 1: Auf Linie gehen mit Kissen auf Kopf (3 min). Station 2: Auf Balancierbalken stehen und Ball fangen (4 min).", material: "Klebebandlinie, Kissen, Balancierbalken, Ball" },
          { title: "Abschluss: Medaillen", type: "Abschluss", dauer: 3, content: "Jedes Kind bekommt eine selbstgemalte Medaille (vorbereitet). Gemeinsame Runde.", material: "Papier-Medaillen (vorbereitet)" }
        ],
        materials: ["Kissen (1 pro Kind)", "Klebeband", "Balancierbalken", "Ball", "Papier-Medaillen"],
        tips: ["Medaillen st√§rken Selbstwert", "Alle gewinnen ‚Äì keine Verlierer", "Kinder gegenseitig anfeuern lassen"]
      },
      {
        title: "Zahlen & Bewegung",
        thema: "Kognition & Motorik verbinden",
        timeline: [
          { title: "Einf√ºhrung: Zahlen-Bewegungen", type: "Einf√ºhrung", dauer: 3, content: "Jeder Zahl wird eine Bewegung zugeordnet: 1=Klatschen, 2=Stampfen, 3=Drehen, 4=H√ºpfen, 5=Arme hoch.", material: "Zahlenkarten" },
          { title: "Warm-up: Karte zeigen ‚Äì bewegen", type: "Warm-up", dauer: 3, content: "Lehrperson zeigt Karten ‚Äì alle f√ºhren Bewegung aus. Tempo steigern.", material: "Zahlenkarten" },
          { title: "Hauptteil: Zahlen-Staffel", type: "Hauptteil", dauer: 6, content: "In 2 Teams: Lehrperson ruft Zahl, erstes Kind macht Bewegung + l√§uft zur Wand und zur√ºck. Dann n√§chstes Kind.", material: "Zahlenkarten, Klebebandlinie" },
          { title: "Abschluss: Mein Liebling", type: "Abschluss", dauer: 3, content: "Jedes Kind zeigt seine Lieblingsbewegung. Alle machen sie gemeinsam nach.", material: "Keine" }
        ],
        materials: ["Zahlenkarten (1‚Äì5 oder 1‚Äì10)", "Klebeband"],
        tips: ["Lerneffekt: Zahlen durch Bewegung verankern", "Tempo anpassen", "Schwierigere Zahlen f√ºr √§ltere Kinder"]
      },
      {
        title: "Seilspringen & Rhythmus",
        thema: "Koordination & Rhythmus",
        timeline: [
          { title: "Einf√ºhrung & Demo", type: "Einf√ºhrung", dauer: 2, content: "Lehrperson springt Seil vor. Kinder schauen zu und wollen es ausprobieren.", material: "Sprungseile" },
          { title: "Warm-up: H√ºpfen ohne Seil", type: "Warm-up", dauer: 3, content: "Beide Beine zusammen h√ºpfen, dann abwechselnd, dann auf der Stelle drehen.", material: "Keine" },
          { title: "Hauptteil: Seilspringen", type: "Hauptteil", dauer: 7, content: "Jedes Kind springt mit eigenem Seil. Wer noch √ºbt: Seil auf Boden legen und dar√ºber h√ºpfen. Dann Langseil f√ºr Gruppe.", material: "Sprungseile (1 pro Kind), Langseil (1)" },
          { title: "Abschluss: Seil-Kreis", type: "Abschluss", dauer: 3, content: "Alle halten gemeinsam ein langes Seil im Kreis. Zusammen hochheben und senken.", material: "Langseil (1)" }
        ],
        materials: ["Sprungseile (1 pro Kind)", "Langseil (1)"],
        tips: ["Nicht alle k√∂nnen sofort springen", "Auf dem Boden-Variante f√ºr Anf√§nger", "Langseil macht gro√üen Spa√ü"]
      },
      {
        title: "Kooperationsspiele",
        thema: "Teamwork & Vertrauen",
        timeline: [
          { title: "Einf√ºhrung: Wir schaffen es zusammen", type: "Einf√ºhrung", dauer: 3, content: "Kurze Erkl√§rung: Heute gewinnen wir nur zusammen. Kein gegen, nur mit.", material: "Keine" },
          { title: "Warm-up: Spiegel zu zweit", type: "Warm-up", dauer: 3, content: "Paare: einer macht Bewegungen, der andere spiegelt. Dann wechseln.", material: "Keine" },
          { title: "Hauptteil: Gruppenaufgaben", type: "Hauptteil", dauer: 6, content: "1) Alle gemeinsam einen Ball auf einer Decke transportieren ohne ihn fallen zu lassen (3 min). 2) Menschenkette: alle halten sich an Kn√∂cheln und bewegen sich (3 min).", material: "Ball, Decke/Tuch" },
          { title: "Abschluss: Jubel-Kreis", type: "Abschluss", dauer: 3, content: "Alle in Kreis, H√§nde zusammen in Mitte. Gemeinsamer Jubel-Ruf. Dann ruhiges Ausatmen.", material: "Keine" }
        ],
        materials: ["Ball (1)", "Gro√üe Decke oder Tuch"],
        tips: ["Kooperation explizit loben", "Konkurrenz vermeiden", "Frustration bei Scheitern auffangen"]
      },
      {
        title: "Yoga f√ºr Kinder",
        thema: "K√∂rperwahrnehmung & Ruhe",
        timeline: [
          { title: "Einf√ºhrung: Tiere im Yoga", type: "Einf√ºhrung", dauer: 2, content: "Yoga wird als Tierimitation eingef√ºhrt. Kinder kennen die Tiere ‚Äì das motiviert!", material: "Matten" },
          { title: "Warm-up: Aufw√§rm-Tier", type: "Warm-up", dauer: 3, content: "Katze-Kuh: auf allen Vieren R√ºcken runden und strecken. 10x wiederholen.", material: "Matten" },
          { title: "Hauptteil: Tier-Yoga-Reise", type: "Hauptteil", dauer: 7, content: "Hund (Abw√§rtshund), Kobra (Bauch, Oberk√∂rper heben), Baum (Einbeinstand), Krieger (breiter Stand, Arme seitlich), Frosch (Hocke).", material: "Matten (1 pro Kind)" },
          { title: "Abschluss: Tote-Mann-Pose", type: "Abschluss", dauer: 3, content: "Alle liegen flach auf R√ºcken, Augen zu. 1 Minute ruhig atmen. Leise Musik.", material: "Matten, Musik-Player" }
        ],
        materials: ["Matten (1 pro Kind)", "Musik-Player"],
        tips: ["Yogaposen nicht erzwingen", "K√∂rper h√∂ren lernen betonen", "Perfekte Abschlussaktivit√§t"]
      }
    ],
    30: [
      {
        title: "Bewegungs-Olympiade",
        thema: "Vielfalt & Wettkampf",
        timeline: [
          { title: "Er√∂ffnungsfeier", type: "Einf√ºhrung", dauer: 5, content: "Einmarsch der Teams (je 2‚Äì4 Kinder). Jedes Team bekommt eine Farbe. Kurze Erkl√§rung der Stationen.", material: "Farbige Armb√§nder oder T√ºcher" },
          { title: "Warm-up: Olympisches Feuer", type: "Warm-up", dauer: 5, content: "Mit Fackel (Tuch am Stab) durch den Raum laufen und an alle 'Feuer anz√ºnden' (antippen). Danach gemeinsames Aufw√§rmritual.", material: "Stab mit Tuch" },
          { title: "Stationen-Olympiade", type: "Hauptteil", dauer: 14, content: "Station 1: Weitwurf mit Sandsack (3 min). Station 2: Hindernislauf (3 min). Station 3: Zielwerfen (3 min). Station 4: Balancier-Wettbewerb (3 min). Wechsel nach Signal.", material: "Sands√§cke, Hindernismaterial, Zielkorb, Balancierbalken" },
          { title: "Siegerehrung & Entspannung", type: "Abschluss", dauer: 6, content: "Alle sind Gewinner! Jedes Kind bekommt Medaille. Danach gemeinsame Entspannung auf Matten.", material: "Papiermedaillen, Matten" }
        ],
        materials: ["Farbige T√ºcher/Armb√§nder (nach Teamgr√∂√üe)", "Sands√§cke (5)", "Hindernismaterial", "Zielkorb", "Balancierbalken", "Papiermedaillen", "Matten"],
        tips: ["Fokus auf Teilnahme, nicht Sieg", "Teams ausgewogen zusammenstellen", "Applaus f√ºr jeden Versuch"]
      },
      {
        title: "Tanztheater",
        thema: "Kreativit√§t & Ausdrucksst√§rke",
        timeline: [
          { title: "Einstieg: Geschichte vorstellen", type: "Einf√ºhrung", dauer: 5, content: "Kurze Geschichte wird vorgestellt (z.B. Dschungel-Abenteuer). Kinder w√§hlen Rollen: L√∂we, Elefant, Affe, Schlange.", material: "Bildkarten mit Tieren" },
          { title: "Warm-up: Tiere erwachen", type: "Warm-up", dauer: 5, content: "Jedes Tier erwacht anders: L√∂we streckt sich, Elefant r√ºsselt, Affe kratzt sich, Schlange zischt.", material: "Keine" },
          { title: "Hauptteil: Tanztheater auff√ºhren", type: "Hauptteil", dauer: 14, content: "Geschichte wird mit Musik 'aufgef√ºhrt'. Lehrperson erz√§hlt, Kinder agieren. 2 Durchl√§ufe mit Rollenwechsel.", material: "Musik-Player, Kost√ºm-Accessoires (optional)" },
          { title: "Abschluss: Verbeugung & Nachgespr√§ch", type: "Abschluss", dauer: 6, content: "Alle verbeugen sich. Kurzes Gespr√§ch: Welche Rolle hat am meisten Spa√ü gemacht?", material: "Keine" }
        ],
        materials: ["Bildkarten Tiere", "Musik-Player", "Kost√ºm-Accessoires (optional)"],
        tips: ["Geschichte vorher vorbereiten", "Sch√ºchterne Kinder sanft einladen", "Kreativit√§t √ºber Korrektheit stellen"]
      },
      {
        title: "Naturparcours drinnen",
        thema: "Grobmotorik & Fantasie",
        timeline: [
          { title: "Einf√ºhrung: Naturforscher", type: "Einf√ºhrung", dauer: 4, content: "Kinder sind heute Naturforscher! Ausr√ºstung: jeder bekommt eine Lupe (Papier-Lupe). Kurze Erkl√§rung des Parcours.", material: "Papier-Lupen (gebastelt)" },
          { title: "Warm-up: Waldtiere imitieren", type: "Warm-up", dauer: 6, content: "Hirsch (elegant laufen), Eule (drehen, Kopf bewegen), Fuchs (schleichen), Reh (springen).", material: "Keine" },
          { title: "Hauptteil: Forscher-Parcours", type: "Hauptteil", dauer: 14, content: "1) Baumstamm √ºberqueren (Balken, 3 min). 2) B√§renh√∂hle (Tunnel, 3 min). 3) Berg√ºberquerung (Kissenturm, 3 min). 4) Fluss√ºberquerung (Sprungpunkte aus Papier, 3 min). Kinder rotieren.", material: "Balancierbalken, Tunnel, Kissen, Papier-Kreise" },
          { title: "Abschluss: Forscher-Tagebuch", type: "Abschluss", dauer: 6, content: "Jedes Kind zeichnet sein Lieblingserlebnis auf einem kleinen Zettel. Gemeinsames Erz√§hlen.", material: "Stifte, Papier" }
        ],
        materials: ["Papier-Lupen", "Balancierbalken", "Kriechtunnel", "Kissen (8)", "Papier-Kreise (10)", "Stifte", "Papier"],
        tips: ["Naturforscher-Rolle gibt Struktur", "Zeichnen am Ende verankert Erlebnis", "Drau√üen-Version im Sommer ideal"]
      },
      {
        title: "Ball-Meisterschaft",
        thema: "Ballgef√ºhl & Koordination",
        timeline: [
          { title: "Einf√ºhrung & Aufw√§rmen", type: "Einf√ºhrung", dauer: 5, content: "Jedes Kind bekommt einen Ball. Freies Erkunden: prellen, rollen, hochwerfen, fangen.", material: "B√§lle (1 pro Kind)" },
          { title: "Warm-up: Dribbling", type: "Warm-up", dauer: 5, content: "Ball am Ort prellen, dann im Laufen. Wechsel Hand. Tempo variieren.", material: "B√§lle (1 pro Kind)" },
          { title: "Hauptteil: Ball-Spiele", type: "Hauptteil", dauer: 14, content: "1) Zielwerfen in Kisten (4 min). 2) V√∂lkerball-Mini (3 min). 3) Staffellauf mit Ball zwischen Knien (4 min). 4) Freies Ballspiel (3 min).", material: "B√§lle, Kisten (3), Klebebandfeld" },
          { title: "Abschluss: Ball-Yoga", type: "Abschluss", dauer: 6, content: "Mit Ball auf dem Boden liegen: Ball unter R√ºcken (Massage), Ball zwischen H√§nden dr√ºcken, langsam abrollen.", material: "B√§lle (1 pro Kind), Matten" }
        ],
        materials: ["B√§lle (1 pro Kind)", "Kisten (3)", "Klebeband", "Matten"],
        tips: ["V√∂lkerball sanft und fair spielen", "Ball-Yoga entspannt sehr gut", "Alle F√§higkeitsstufen einschlie√üen"]
      },
      {
        title: "Sinneswerkstatt",
        thema: "Wahrnehmung & Konzentration",
        timeline: [
          { title: "Einf√ºhrung: Die 5 Sinne", type: "Einf√ºhrung", dauer: 5, content: "Kurze Vorstellung der 5 Sinne mit K√∂rperbewegungen: Sehen (Augen auf-zu), H√∂ren (H√§nde an Ohren), Riechen (schnuppern), Schmecken (Zunge raus), F√ºhlen (H√§nde reiben).", material: "Keine" },
          { title: "Warm-up: Sinnes-Tour", type: "Warm-up", dauer: 5, content: "Augen geschlossen: Ger√§usche erraten (Rasseln, Klatschen). Dann Ger√ºche erraten (Zitrone, Lavendel).", material: "Rasseln, Geruchs-Dosen" },
          { title: "Hauptteil: Sinnes-Stationen", type: "Hauptteil", dauer: 14, content: "Station 1: F√ºhlen mit verbundenen Augen (Gegenst√§nde ertasten, 4 min). Station 2: Ger√§usche-Memory (Dosen sch√ºtteln und paaren, 4 min). Station 3: Gleichgewicht mit verbundenen Augen (4 min). Station 4: Geruchs-Parcours (2 min).", material: "Augenbinden, F√ºhl-Box, Ger√§usche-Dosen, Geruchs-Dosen" },
          { title: "Abschluss: Achtsamkeits-Moment", type: "Abschluss", dauer: 6, content: "Alle sitzen still. 1 Minute: Was h√∂re ich? Was f√ºhle ich? Danach erz√§hlen.", material: "Keine" }
        ],
        materials: ["Augenbinden (1 pro Kind)", "F√ºhl-Box mit Gegenst√§nden", "Ger√§usche-Dosen (5 Paare)", "Geruchs-Dosen (4)"],
        tips: ["Augenbinde nur auf Freiwilligkeit", "F√ºhlen mit geschlossenen Augen sehr spannend", "Sehr beruhigendes Ende"]
      },
      {
        title: "Gro√ües Gemeinschaftsspiel",
        thema: "Soziale Kompetenz & Inklusion",
        timeline: [
          { title: "Einf√ºhrung: Wir-Gef√ºhl st√§rken", type: "Einf√ºhrung", dauer: 5, content: "Alle in Kreis. Gemeinsamer Name f√ºr die Gruppe wird gew√§hlt (z.B. 'Die Sterne'). Alle sagen ihn zusammen.", material: "Keine" },
          { title: "Warm-up: Bewegungs-Telefon", type: "Warm-up", dauer: 5, content: "Wie Stille Post: Bewegung wird von Kind zu Kind weitergegeben. Wie ver√§ndert sie sich?", material: "Keine" },
          { title: "Hauptteil: Kooperations-Spiele", type: "Hauptteil", dauer: 14, content: "1) Menschenknoten l√∂sen (4 min). 2) Alle m√ºssen gleichzeitig auf St√ºhle klettern ohne den Boden zu ber√ºhren (5 min). 3) Gemeinsam eine Figur aus K√∂rpern legen (5 min).", material: "St√ºhle (1 pro Kind)" },
          { title: "Abschluss: Wir-Foto", type: "Abschluss", dauer: 6, content: "Alle bauen gemeinsam eine lustige Pose auf. Optional: Foto machen. Dann ruhiges Sitzen und Nachbesprechen.", material: "Kamera (optional)" }
        ],
        materials: ["St√ºhle (1 pro Kind)", "Kamera (optional)"],
        tips: ["Kein Kind ausgrenzen", "L√∂sungen kommen von Kindern", "K√∂rperbilder sind kreativ und verbindend"]
      }
    ]
  }
};

// Spr√ºche und Vorlagen-Z√§hler (global im Tab)
let quoteIndex = 0;
let templateCounters = {
  krippe_15: 0,
  krippe_30: 0,
  kindergarten_15: 0,
  kindergarten_30: 0
};

function showStatus(msg, type) {
  const el = document.getElementById("status");
  el.textContent = msg;
  el.className = type;
}

function setLoading(loading) {
  const btn = document.getElementById("generateBtn");
  const txt = document.getElementById("btnText");
  btn.disabled = loading;
  btn.classList.toggle("loading", loading);
  txt.textContent = loading ? "Generiere..." : "Stunde generieren";
}

function getMaterialWithCount(mat, kinder) {
  // Mengen anpassen wenn Anzahl pro Kind notiert
  if (mat.includes("pro Kind")) {
    const base = mat.replace(/\(.*\)/, "").trim();
    return `${base} (${kinder}√ó)`;
  }
  return mat;
}

function renderResult(template, kinder, dauer) {
  const el = document.getElementById("result-content");
  const startMinute = 0;

  // Meta
  let currentMin = 0;
  const metaHtml = `
    <div class="result-section">
      <h3>üìã √úbersicht</h3>
      <div class="meta-grid">
        <div class="meta-item"><div class="val">${document.getElementById("bereich").options[document.getElementById("bereich").selectedIndex].text}</div><div class="key">Bereich</div></div>
        <div class="meta-item"><div class="val">${dauer} min</div><div class="key">Gesamtdauer</div></div>
        <div class="meta-item"><div class="val">${kinder}</div><div class="key">Kinder</div></div>
        <div class="meta-item"><div class="val">${template.thema}</div><div class="key">Thema</div></div>
      </div>
    </div>`;

  // Materialien mit Mengen
  const matsHtml = `
    <div class="result-section">
      <h3>üéí Materialbedarf (f√ºr ${kinder} Kinder)</h3>
      <div class="mat-grid">
        ${template.materials.map(m => {
          const adjusted = getMaterialWithCount(m, kinder);
          return `<div class="mat-item">${adjusted}</div>`;
        }).join('')}
      </div>
    </div>`;

  // Timeline mit exakten Minuten
  let timeMin = 0;
  const timelineHtml = `
    <div class="result-section">
      <h3>‚è± Ablauf</h3>
      ${template.timeline.map(slot => {
        const start = timeMin;
        const end = timeMin + slot.dauer;
        timeMin = end;
        return `
          <div class="timeline-item">
            <div class="t-time">
              ${start}‚Äì${end} min
            </div>
            <div class="t-body">
              <div class="t-title">${slot.title}</div>
              <span class="t-type">${slot.type}</span>
              <div class="t-content">${slot.content}</div>
              ${slot.material && slot.material !== "Keine" ? `<div class="t-material">üì¶ Material: ${slot.material}</div>` : ''}
            </div>
          </div>`;
      }).join('')}
    </div>`;

  // Tipps
  const tipsHtml = template.tips.length ? `
    <div class="result-section">
      <h3>üí° Tipps f√ºr die Durchf√ºhrung</h3>
      ${template.tips.map(t => `<div class="tip-item">${t}</div>`).join('')}
    </div>` : '';

  // Abschlussspruch (rotierend, keine Wiederholung von bewegt & bunt)
  const quote = CLOSING_QUOTES[quoteIndex % CLOSING_QUOTES.length];
  quoteIndex++;
  const quoteHtml = `
    <div class="closing-quote">
      <blockquote>‚Äû${quote.text}"</blockquote>
      <div class="quote-author">‚Äî ${quote.author}</div>
    </div>`;

  el.innerHTML = metaHtml + matsHtml + timelineHtml + tipsHtml + quoteHtml;
  document.getElementById("result").style.display = "block";
}

async function generate() {
  document.getElementById("status").className = "";
  document.getElementById("status").textContent = "";

  const bereich = document.getElementById("bereich").value;
  const dauer = parseInt(document.getElementById("targetMinutes").value);
  const kinder = parseInt(document.getElementById("kinderAnzahl").value);
  const heute = new Date();
  const monat = heute.getMonth() + 1; // 1-12

  if (![15, 30].includes(dauer)) {
    showStatus("‚ö†Ô∏è Bitte 15 oder 30 Minuten w√§hlen.", "error");
    return;
  }

  setLoading(true);

  // Strikte Reihenfolge, kein Zufall
  const key = `${bereich}_${dauer}`;
  const pool = TEMPLATES[bereich][dauer];
  const idx = templateCounters[key] % pool.length;
  templateCounters[key]++;

  const template = pool[idx];

  // Kurze Verz√∂gerung f√ºr UX
  await new Promise(r => setTimeout(r, 600));

  renderResult(template, kinder, dauer);
  showStatus(`‚úÖ Vorlage ${idx + 1} von ${pool.length} generiert`, "success");
  setLoading(false);

  // Verlauf speichern
  saveToHistory(template, kinder, dauer, bereich);

  // Scroll zum Ergebnis
  document.getElementById("result").scrollIntoView({ behavior: "smooth" });
}

// ‚îÄ‚îÄ VERLAUF laden ‚îÄ‚îÄ
async function loadHistory() {
  if (!supabaseClient) return;
  const { data: session } = await supabaseClient.auth.getSession();
  if (!session.session) return;

  const { data, error } = await supabaseClient
    .from('generated_sessions')
    .select('*')
    .eq('user_id', session.session.user.id)
    .order('created_at', { ascending: false })
    .limit(5);

  const list = document.getElementById('historyList');
  const section = document.getElementById('historySection');

  if (error || !data || data.length === 0) {
    section.style.display = 'none';
    return;
  }

  section.style.display = 'block';
  list.innerHTML = data.map(s => {
    const date = new Date(s.created_at).toLocaleDateString('de-DE', {day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit'});
    return `<div style="background:#fff;border:1px solid var(--border);border-radius:12px;padding:1rem 1.2rem;margin-bottom:0.7rem;display:flex;align-items:center;justify-content:space-between;">
      <div>
        <div style="font-weight:700;font-size:0.95rem;">${s.title || s.template_key || 'Bewegungsstunde'}</div>
        <div style="font-size:0.78rem;color:var(--grey);margin-top:0.2rem;">${date} ¬∑ ${s.duration_minutes || '‚Äì'} min ¬∑ ${s.children_count || '‚Äì'} Kinder</div>
      </div>
      <span style="font-size:1.3rem;">üìã</span>
    </div>`;
  }).join('');
}

// Verlauf nach Login laden
(async () => {
  if (!supabaseClient) return;
  await new Promise(r => setTimeout(r, 500));
  await loadHistory();
})();

// Verlauf nach Generieren speichern
async function saveToHistory(template, kinder, dauer, bereich) {
  if (!supabaseClient) return;
  const { data: session } = await supabaseClient.auth.getSession();
  if (!session.session) return;
  try {
    await supabaseClient.from('generated_sessions').insert({
      user_id: session.session.user.id,
      title: template.title,
      template_key: bereich + '_' + dauer,
      duration_minutes: dauer,
      children_count: kinder,
      created_at: new Date().toISOString()
    });
    await loadHistory();
  } catch(e) { console.log('History save skipped:', e.message); }
}

// ‚îÄ‚îÄ SAISONALE ANZEIGE ‚îÄ‚îÄ
(function() {
  const m = new Date().getMonth() + 1;
  let saison, icon;
  if ([12,1,2].includes(m))      { saison = 'Winter'; icon = '‚ùÑÔ∏è'; }
  else if ([3,4,5].includes(m))  { saison = 'Fr√ºhling'; icon = 'üå∏'; }
  else if ([6,7,8].includes(m))  { saison = 'Sommer'; icon = '‚òÄÔ∏è'; }
  else                            { saison = 'Herbst'; icon = 'üçÇ'; }
  
  // Ostern April/M√§rz check
  if (m === 4) { saison = 'Ostern / Fr√ºhling'; icon = 'üê£'; }
  if (m === 12) { saison = 'Advent / Winter'; icon = 'üïØÔ∏è'; }
  
  const badge = document.getElementById('seasonBadge');
  if (badge) badge.innerHTML = icon + ' Aktuelle Saison: <strong style="margin-left:4px">' + saison + '</strong>&nbsp;¬∑ Vorlagen passen sich automatisch an';
})();
</script>
</body>
</html>
